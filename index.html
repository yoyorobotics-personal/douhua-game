<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±†èŠ±å¥‡ç¼˜ | The Tofu Pudding</title>
    <style>
              .home-btn{
          z-index: 2000;          /* æé«˜å±‚çº§ï¼Œå‹è¿‡ä»»ä½•æµ®å±‚ */
          pointer-events: auto;   /* æ˜ç¡®å…è®¸ç‚¹å‡» */
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        /* é›¨æ»´æ•ˆæœ */
        .rain {
            position: absolute;
            width: 2px;
            height: 50px;
            background: linear-gradient(transparent, rgba(255,255,255,0.3));
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            min-height: 600px;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 10;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 20px 20px 0 0;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1em;
            opacity: 0.9;
        }

        .header .version {
            font-size: 0.8em;
            opacity: 0.7;
            margin-top: 5px;
        }

        .content {
            padding: 40px;
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;           /* å¹³æ»‘æ»šåŠ¨ */
            -webkit-overflow-scrolling: touch; /* iOS æƒ¯æ€§æ»šåŠ¨ */
            max-height: 70vh;                  /* é™åˆ¶æœ€å¤§é«˜åº¦ï¼Œé¿å…å†…å®¹æ’‘å‡ºå®¹å™¨ */
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ï¼ˆå¯æŒ‰éœ€åˆ é™¤ï¼‰ */
        .content::-webkit-scrollbar { width: 8px; }
        .content::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 4px;
        }
        .content::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.8);
        }

        .menu-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
            width: 100%;
            text-align: left;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .menu-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .menu-item:active {
            transform: translateY(-1px);
        }

        .story-text {
            line-height: 2;
            font-size: 1.1em;
            color: #333;
            margin: 20px 0;
            text-align: justify;
        }

        .story-text.typing {
            border-right: 2px solid #667eea;
            animation: blink 0.7s infinite;
        }

        @keyframes blink {
            50% { border-color: transparent; }
        }

        .choice-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 12px 25px;
            margin: 8px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            display: inline-block;
        }

        .choice-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .divider {
            border: none;
            height: 2px;
            background: linear-gradient(to right, transparent, #667eea, transparent);
            margin: 30px 0;
        }

        .clue-badge {
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin: 5px;
            animation: fadeInScale 0.5s;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.5);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .ending-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .ending-box h2 {
            font-size: 2em;
            margin-bottom: 15px;
        }

        .about-section {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .about-section h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .credits-link {
            color: #667eea;
            text-decoration: none;
            border-bottom: 1px dashed #667eea;
            transition: all 0.3s;
        }

        .credits-link:hover {
            color: #764ba2;
            border-bottom: 1px solid #764ba2;
        }

        .thunder-effect {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 9999;
        }

        .thunder-effect.active {
            animation: thunder 0.3s;
        }

        @keyframes thunder {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.8; }
        }

        .continue-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .continue-btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .save-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .save-indicator.show {
            opacity: 1;
        }

        .speed-control {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .speed-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .speed-btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .speed-btn.active {
            background: #f5576c;
        }

        .skip-hint {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            pointer-events: none;
        }

        .skip-hint.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            .content {
                padding: 20px;
            }
            .choice-btn {
                display: block;
                width: 100%;
                margin: 8px 0;
            }
        }
            /* ===== è¿”å›ä¸»é¡µæŒ‰é’® ===== */
        .home-btn {
            position: absolute;
            top: 18px;
            left: 30px;
            display: flex;                   /* âœ… ä½¿ç”¨ flex å±…ä¸­ */
            align-items: center;             /* å‚ç›´å±…ä¸­ */
            justify-content: center;         /* æ°´å¹³å±…ä¸­ */
            background: rgba(0,0,0,0.25);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.6);
            padding: 6px 14px;               /* å¾®è°ƒä¸Šä¸‹å†…è¾¹è· */
            border-radius: 10px;
            font-size: 0.95em;
            line-height: 1;                  /* å»æ‰ç³»ç»Ÿé»˜è®¤è¡Œé«˜ */
            cursor: pointer;
            transition: all .2s;
            backdrop-filter: blur(2px);
            z-index: 2000;
        }
        .home-btn:hover {
            background: rgba(0,0,0,0.45);
            transform: translateY(-1px);
        }
        /* ======= å‰§æƒ…ç‰¹æ•ˆï¼šæƒŠè®¶æç¤º ======= */
        .story-alert {
          font-size: 1.3em;
          color: #282828;
          text-align: center;
          letter-spacing: 1px;
          margin: 15px 0;
          padding: 10px 15px;
          animation: pulseGlow 1.6s ease-in-out infinite alternate;
        }

        /* åˆ†éš”çº¿ */
        .divider {
          border: none;
          height: 1px;
          background: linear-gradient(to right, transparent, rgba(97, 97, 97, 0.5), transparent);
          margin: 15px 0;
        }
        #translateHint {
          position: fixed;
          top: 15px;
          right: 15px;
          font-size: 1.2em;
          background: rgba(0,0,0,0.25);
          color: #fff;
          border: 1px solid rgba(255,255,255,0.6);
          border-radius: 50%;
          width: 36px;
          height: 36px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          backdrop-filter: blur(2px);
          transition: all 0.25s;
          z-index: 9999;
        }

        #translateHint:hover {
          background: rgba(255,255,255,0.25);
          transform: scale(1.1);
        }



    </style>
</head>
<body>
    <div class="thunder-effect" id="thunderEffect"></div>
    <div class="container">
        <div class="header">
            <h1>è±†èŠ±å¥‡ç¼˜</h1>
            <div class="subtitle">The Tofu Pudding</div>
            <div class="version">v1.0.0</div>
        </div>
        <div class="save-indicator" id="saveIndicator">ğŸ’¾ å·²è‡ªåŠ¨ä¿å­˜</div>
        <div class="content" id="gameContent">
            <!-- æ¸¸æˆå†…å®¹å°†åŠ¨æ€æ’å…¥è¿™é‡Œ -->
        </div>
    </div>

    <script>
        // åˆ›å»ºé›¨æ»´æ•ˆæœ
        function createRain() {
            const rainCount = 50;
            for (let i = 0; i < rainCount; i++) {
                const rain = document.createElement('div');
                rain.className = 'rain';
                rain.style.left = Math.random() * 100 + '%';
                rain.style.animationDuration = (Math.random() * 1 + 0.5) + 's';
                rain.style.animationDelay = Math.random() * 2 + 's';
                document.body.appendChild(rain);
            }
        }
        createRain();

        // æ¸¸æˆçŠ¶æ€ç®¡ç†
        const gameState = {
            clues: [],
            currentScene: 'menu',
            choices: []
        };

        // ä¿å­˜æ¸¸æˆ
        function saveGame() {
            localStorage.setItem('douhua_save', JSON.stringify(gameState));
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 2000);
        }

        // åŠ è½½æ¸¸æˆ
        function loadGame() {
            const saved = localStorage.getItem('douhua_save');
            if (saved) {
                const data = JSON.parse(saved);
                gameState.clues = data.clues || [];
                gameState.currentScene = data.currentScene || 'menu';
                return true;
            }
            return false;
        }

        // æ‰“å­—æœºæ•ˆæœ
        function typeWriter(element, text, speed = 30) {
            return new Promise((resolve) => {
                let i = 0;
                element.classList.add('typing');
                const timer = setInterval(() => {
                    if (i < text.length) {
                        element.textContent += text.charAt(i);
                        i++;
                        // æ‰“å­—è¿‡ç¨‹ä¸­è®©å®¹å™¨è·Ÿéšåˆ°åº•
                        if (i % 3 === 0) scrollToBottom();
                    } else {
                        element.classList.remove('typing');
                        clearInterval(timer);
                        // æ‰“å­—ç»“æŸï¼Œç¡®ä¿æ»šåŠ¨åˆ°åº•
                        scrollToBottom();
                        resolve();
                    }
                }, speed);
            });
        }

        // æ·»åŠ çº¿ç´¢
        function addClue(clue) {
            if (!gameState.clues.includes(clue)) {
                gameState.clues.push(clue);
                saveGame();
                return true;
            }
            return false;
        }

        // æ˜¾ç¤ºçº¿ç´¢
        function showClues() {
            const cluesHtml = gameState.clues.map(clue => 
                `<span class="clue-badge">ğŸ” ${clue}</span>`
            ).join('');
            return `<div style="margin: 20px 0;">
                <strong>å·²æ”¶é›†çº¿ç´¢ (${gameState.clues.length}/5):</strong><br>
                ${cluesHtml || 'æš‚æ— çº¿ç´¢'}
            </div>`;
        }

        
        // æ»šåŠ¨åˆ°å†…å®¹åº•éƒ¨ï¼ˆä¿æŒæœ€æ–°æ–‡æœ¬å¯è§ï¼‰
        function scrollToBottom() {
            const el = document.getElementById('gameContent');
            if (!el) return;
            el.scrollTop = el.scrollHeight;
        }

        // æ¸²æŸ“å†…å®¹
        function render(html) {
            setupHomeButton();
            document.getElementById('gameContent').innerHTML = html;
            // åˆæ¬¡æ¸²æŸ“åæ»šåŠ¨åˆ°åº•éƒ¨
            scrollToBottom();
            
        }

        // é›·ç”µæ•ˆæœ
        function thunderEffect() {
            const effect = document.getElementById('thunderEffect');
            effect.classList.add('active');
            setTimeout(() => effect.classList.remove('active'), 300);
        }

        // ===== åœºæ™¯å‡½æ•° =====

        function showMainMenu() {
            gameState.currentScene = 'menu';
            const hasSave = localStorage.getItem('douhua_save') !== null;
            render(`
                <div style="text-align: center;">
                    <button class="menu-item" onclick="startNewGame()">ğŸ® å¼€å§‹æ–°æ¸¸æˆ</button>
                    <button class="menu-item" onclick="continueGame()" ${!hasSave ? 'style="opacity:0.5;" disabled' : ''}>
                        ğŸ’¾ ç»§ç»­æ¸¸æˆ
                    </button>
                    <button class="menu-item" onclick="showInstructions()">ğŸ“– æ¸¸æˆè¯´æ˜</button>
                    <button class="menu-item" onclick="showAbout()">â„¹ï¸ å…³äºæ¸¸æˆ</button>
                    <button class="menu-item" onclick="showCredits()">ğŸ‘¤ åˆ¶ä½œå›¢é˜Ÿ</button>
                </div>
            `);
            setupHomeButton();

        }

        function showInstructions() {
            render(`
                <h2 style="color: #667eea;">ğŸ“– æ¸¸æˆè¯´æ˜</h2>
                <hr class="divider">
                <div class="about-section">
                    <h3>ğŸ® æ¸¸æˆç®€ä»‹</h3>
                    <p>è¿™æ˜¯ä¸€æ¬¾æ–‡å­—å†’é™©æ¸¸æˆï¼Œä½ å°†æ‰®æ¼”è½é­„é“å£«æ²ˆè¨€ï¼Œåœ¨ä¸€ä¸ªé›¨å¤©å¶é‡å–è±†èŠ±çš„è€ç‹å¤´ï¼Œä»è€Œå‘ç°å¤±ä¼ å·²ä¹…çš„ã€Šä¹éœ„å¼•é›·è¯€ã€‹çš„çº¿ç´¢ã€‚</p>
                </div>
                <div class="about-section">
                    <h3>ğŸ¯ å¦‚ä½•æ¸¸ç©</h3>
                    <p>â€¢ ä»”ç»†é˜…è¯»æ¯ä¸€æ®µæ–‡å­—ï¼Œå…¶ä¸­å¯èƒ½éšè—ç€é‡è¦çº¿ç´¢<br>
                    â€¢ ç‚¹å‡»æŒ‰é’®åšå‡ºé€‰æ‹©<br>
                    â€¢ ä¸åŒçš„é€‰æ‹©ä¼šå¯¼å‘ä¸åŒçš„ç»“å±€<br>
                    â€¢ å°½å¯èƒ½æ”¶é›†æ›´å¤šçº¿ç´¢ï¼Œè·å¾—æ›´å¥½çš„ç»“å±€</p>
                </div>
                <div class="about-section">
                    <h3>ğŸ’¡ å°è´´å£«</h3>
                    <p>â€¢ æ¸¸æˆå…±æœ‰4ç§ä¸åŒç»“å±€<br>
                    â€¢ æ”¶é›†æ‰€æœ‰5æ¡çº¿ç´¢å¯ä»¥è¾¾æˆæœ€å¥½çš„ç»“å±€<br>
                    â€¢ æ¸¸æˆä¼šåœ¨å…³é”®èŠ‚ç‚¹è‡ªåŠ¨ä¿å­˜<br>
                </div>
                <button class="continue-btn" onclick="showMainMenu()">è¿”å›ä¸»èœå•</button>
            `);
        }

        function showAbout() {
            render(`
                <h2 style="color: #667eea;">â„¹ï¸ å…³äºæ¸¸æˆ</h2>
                <hr class="divider">
                <div class="about-section">
                    <h3>ğŸ® æ¸¸æˆä¿¡æ¯</h3>
                    <p><strong>æ¸¸æˆåç§°:</strong> è±†èŠ±å¥‡ç¼˜ (The Tofu Pudding)<br>
                    <strong>ç‰ˆæœ¬:</strong> v1.0.0<br>
                    <strong>å‘å¸ƒæ—¥æœŸ:</strong> 2025å¹´11æœˆ<br>
                    <strong>ç±»å‹:</strong> æ–‡å­—å†’é™©æ¸¸æˆ</p>
                </div>
                <div class="about-section">
                    <h3>ğŸ“ ç‰ˆæƒä¿¡æ¯</h3>
                    <p>Â© 2025 æ…¢æ‚ æ‚ çš„è±†èŠ±å·¥ä½œå®¤ ä¿ç•™æ‰€æœ‰æƒåˆ©<br>
                    æœ¬æ¸¸æˆå—ç‰ˆæƒæ³•ä¿æŠ¤ï¼Œæœªç»æˆæƒä¸å¾—å¤åˆ¶ã€åˆ†å‘æˆ–ä¿®æ”¹</p>
                </div>
                <div class="about-section">
                    <h3>âš–ï¸ ä½¿ç”¨è®¸å¯</h3>
                    <p>â€¢ æœ¬æ¸¸æˆä»…ä¾›ä¸ªäººå¨±ä¹ä½¿ç”¨<br>
                    â€¢ ç¦æ­¢ç”¨äºå•†ä¸šç›®çš„<br>
                    â€¢ æ¸¸æˆå†…å®¹çº¯å±è™šæ„ï¼Œå¦‚æœ‰é›·åŒï¼Œçº¯å±å·§åˆ</p>
                </div>
                <div class="about-section">
                    <h3>ğŸ”’ éšç§æ”¿ç­–</h3>
                    <p>æœ¬æ¸¸æˆä¸æ”¶é›†ä»»ä½•ä¸ªäººä¿¡æ¯ï¼Œå­˜æ¡£æ–‡ä»¶ä»…ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ã€‚</p>
                </div>
                <button class="continue-btn" onclick="showMainMenu()">è¿”å›ä¸»èœå•</button>
            `);
        }

        function showCredits() {
            render(`
                <h2 style="color: #667eea;">ğŸ‘¤ åˆ¶ä½œå›¢é˜Ÿ</h2>
                <hr class="divider">
                <div style="text-align: center; margin: 30px 0;">
                    <h3>ğŸ¬ æ…¢æ‚ æ‚ çš„è±†èŠ±å·¥ä½œå®¤ è£èª‰å‡ºå“</h3>
                </div>
                <div class="about-section">
                    <h3>ğŸ“ åˆ›ä½œå›¢é˜Ÿ</h3>
                    <p><strong>åŸåˆ›æ•…äº‹ & æ¸¸æˆè®¾è®¡:</strong> æ…¢æ‚ æ‚ <br>
                    <strong>è”ç³»æ–¹å¼:</strong> <a href="yoyorobotis@outlook.com" class="credits-link">yoyorobotis@outlook.com</a><br>
                    <strong>GitHub:</strong> <a href="https://github.com/yoyorobotics-personal" class="credits-link" target="_blank">yoyorobotics-personal</a></p>
                </div>
                <div class="about-section">
                    <h3>ğŸ’» æŠ€æœ¯ä¿¡æ¯</h3>
                    <p><strong>å¼€å‘å·¥å…·:</strong> HTML5, CSS3, JavaScript<br>
                    <strong>æ‰˜ç®¡å¹³å°:</strong> GitHub Pages<br>
                    <strong>å¼€æºåè®®:</strong> Apache-2.0 license</p>
                </div>
                <div class="about-section">
                    <h3>ğŸ™ ç‰¹åˆ«æ„Ÿè°¢</h3>
                    <p>â€¢ æ‰€æœ‰æµ‹è¯•ç©å®¶çš„å®è´µæ„è§<br>
                    â€¢ å¼€æºç¤¾åŒºçš„æŠ€æœ¯æ”¯æŒ<br>
                    â€¢ æ¯ä¸€ä½ç©å®¶çš„æ”¯æŒ</p>
                </div>
                <div class="about-section">
                    <h3>ğŸ“® è”ç³»æˆ‘ä»¬</h3>
                    <p>â€¢ ç”µå­é‚®ç®±: <a href="mailto:yoyorobotics@outlook.com" class="credits-link">yoyorobotics@outlook.com</a><br>
                    â€¢ å¾®ä¿¡å…¬ä¼—å·: æ…¢æ‚ æ‚ çš„è±†èŠ±å¥‡ç¼˜<br>
                    â€¢ Bç«™: æ…¢æ‚ æ‚ çš„è±†èŠ±å¥‡ç¼˜<br>
                    â€¢ é—®é¢˜åé¦ˆ: <a href="https://github.com/yoyorobotics-personal/douhua-game/issues" class="credits-link" target="_blank">GitHub Issues</a></p>
                </div>
                <button class="continue-btn" onclick="showMainMenu()">è¿”å›ä¸»èœå•</button>
            `);
        }

        async function startNewGame() {
            gameState.clues = [];
            gameState.currentScene = 'intro';
            saveGame();
            
            render(`<div class="story-text" id="introText"></div>`);
            const introElement = document.getElementById('introText');
            
            await typeWriter(introElement, 'é›¨æ°´é¡ºç€å±‹æªç ¸ä¸‹æ¥ï¼Œåƒè€å¤©çˆ·åœ¨å€’æ´—è„šæ°´ã€‚\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(introElement, 'æ²ˆè¨€è¹²åœ¨å··å­å£ï¼Œé“è¢ä¸‹æ‘†æµ¸åœ¨æ³¥æµ†é‡Œï¼Œè¢–ä¸­ä¸‰å¼ ç´«éœ„å®—çš„è¿½å€ºç¬¦çƒ«å¾—ä»–æ‰‹è…•å‘çº¢ã€‚\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(introElement, 'æ˜¨å¤œåœ¨èµŒåŠè¾“å…‰äº†æœ€åä¸€å—çµçŸ³ï¼Œç°åœ¨è¿ç¢—çƒ­æ±¤éƒ½å–ä¸èµ·ã€‚\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(introElement, 'ä»–æ­ªç€å¤´å•ƒå†·æ‰çš„çƒ§é¥¼ï¼Œå•ƒå¾—ç¢æ¸£æ‰è¿›é¢†å£â€”â€”åƒæ¡è¢«é›¨æ·‹é€çš„é‡ç‹—ï¼Œåç”Ÿç¬‘å¾—æ²¡å¿ƒæ²¡è‚ºã€‚');
            
            introElement.innerHTML += '<br><br><button class="continue-btn" onclick="sceneStart()">ç»§ç»­</button>';
        }

        function continueGame() {
            if (loadGame()) {
                sceneStart();
            }
        }

        async function sceneStart() {
            gameState.currentScene = 'start';
            saveGame();
            
            render(`<div class="story-text" id="startText"></div>`);
            const textElement = document.getElementById('startText');
            
            await typeWriter(textElement, '"å’¸â€”â€”çš„â€”â€”ç”œâ€”â€”çš„â€”â€”çƒ«â€”â€”å˜´â€”â€”çš„â€”â€”"\n\n');
            await new Promise(r => setTimeout(r, 800));
            await typeWriter(textElement, 'æ²™å“‘çš„å†å–åˆºç ´é›¨å¹•ã€‚\n\n');
            await typeWriter(textElement, 'æ²ˆè¨€çŒ›åœ°æŠ¬å¤´ã€‚\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(textElement, 'å–è±†èŠ±çš„è€ç‹å¤´æ¨ç€å±å‘€ä½œå“çš„æœ¨è½¦ï¼Œæ–—ç¬ æ»´ç€æ°´ï¼Œé‚£è°ƒå­å´å¤æ€ªâ€”â€”ä¸‰å£°çŸ­ä¿ƒï¼Œä¸€å£°æ‹‰é•¿ï¼Œå°¾éŸ³æ‰“ç€æ—‹å„¿å¾€å¤©ä¸Šè¹¿...\n\n');
            
            thunderEffect();
            await new Promise(r => setTimeout(r, 800));
            
            textElement.innerHTML += `
              <hr class="divider">
              <div class="story-alert">
                  æ€€é‡Œçš„ç½—ç›˜çªç„¶ç–¯ç‹‚æ—‹è½¬ï¼<br>â€œå¼•é›·è¯€ï¼Ÿï¼â€
              </div>
              <hr class="divider">

                <h3>ä½ è¦æ€ä¹ˆåšï¼Ÿ</h3>
                <button class="choice-btn" onclick="sceneApproachStall()">ç«‹åˆ»å†²åˆ°è±†èŠ±æ‘Šå‰è¯¢é—®</button>
                <button class="choice-btn" onclick="sceneObserve()">å…ˆè§‚å¯Ÿä¸€ä¸‹ï¼Œä¸è¦æ‰“è‰æƒŠè›‡</button>
                <button class="choice-btn" onclick="sceneIgnore()">å‡è£…ä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿï¼Œç»§ç»­å•ƒçƒ§é¥¼</button>
            `;
        }

        async function sceneApproachStall() {
            render(`<div class="story-text" id="approachText"></div>`);
            const textElement = document.getElementById('approachText');
            
            await typeWriter(textElement, 'æ²ˆè¨€è¹¿åˆ°è±†èŠ±æ‘Šå‰ï¼Œç”©å‡ºæœ€åä¸€å—ç¢é“¶ã€‚\n\n');
            await typeWriter(textElement, '"è€ä¼¯ï¼æ‚¨è¿™è°ƒå­è·Ÿè°å­¦çš„ï¼Ÿ"\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(textElement, 'è€ç‹å¤´å¤´ä¹Ÿä¸æŠ¬ï¼Œæœ¨å‹ºåœ¨é”…é‡Œæ…ç€ï¼š"ç¥–ä¼ çš„ï¼æˆ‘çˆ·è¯´ï¼Œå½“å¹´æœ‰ä¸ªä»™äººå–è±†èŠ±æ²¡å¸¦é’±ï¼Œå”±äº†æ®µæ›²å„¿æŠµè´¦ã€‚"\n\n');
            
            addClue('è±†èŠ±è°ƒå­');
            
            textElement.innerHTML += `${showClues()}
                <hr class="divider">
                <h3>ä½ æ³¨æ„åˆ°äº†ä»€ä¹ˆï¼Ÿ</h3>
                <button class="choice-btn" onclick="sceneCheckPole()">æ£€æŸ¥è±†èŠ±è½¦çš„æ‰æ‹…</button>
                <button class="choice-btn" onclick="sceneListen()">ä»”ç»†å¬è€ç‹å¤´çš„å†å–</button>
                <button class="choice-btn" onclick="sceneOrderDouhua()">è¦ä¸€ç¢—è±†èŠ±å°å°</button>
            `;
        }

        async function sceneObserve() {
            render(`<div class="story-text" id="observeText"></div>`);
            const textElement = document.getElementById('observeText');
            
            await typeWriter(textElement, 'ä½ å†³å®šå…ˆè§‚å¯Ÿæƒ…å†µ...\n\n');
            await new Promise(r => setTimeout(r, 1000));
            await typeWriter(textElement, 'è¿œå¤„å‡ ä¸ªå­©ç«¥è¿½ç€è±†èŠ±è½¦è·‘ï¼Œå˜»å˜»å“ˆå“ˆåœ°å­¦ç€å”±ï¼š"å’¸â€”â€”çš„â€”â€”ç”œâ€”â€”çš„â€”â€”"\n\n');
            await new Promise(r => setTimeout(r, 800));
            await typeWriter(textElement, 'ç³Ÿäº†ï¼å¦‚æœå­©å­ä»¬å­¦ä¼šäº†è¿™è°ƒå­ï¼Œè¯´ä¸å®šä¼šå¼•å‘ä»€ä¹ˆå˜æ•…ï¼');
            
            textElement.innerHTML += '<br><br><button class="continue-btn" onclick="sceneApproachStall()">ç«‹åˆ»å†²è¿‡å»ï¼</button>';
        }

        async function sceneIgnore() {
            render(`<div class="story-text" id="ignoreText"></div>`);
            const textElement = document.getElementById('ignoreText');
            
            await typeWriter(textElement, 'ä½ å†³å®šç»§ç»­å•ƒçƒ§é¥¼...\n\n');
            await new Promise(r => setTimeout(r, 1000));
            await typeWriter(textElement, 'è±†èŠ±è½¦æ¸è¡Œæ¸è¿œã€‚\n\n');
            await typeWriter(textElement, 'ç½—ç›˜çš„éœ‡åŠ¨ä¹Ÿæ…¢æ…¢å¹³æ¯äº†ã€‚\n\n');
            await new Promise(r => setTimeout(r, 1000));
            await typeWriter(textElement, 'ä¸‰å¤©åï¼Œä½ å¬è¯´åŸè¥¿å‡ºç°äº†ä¸€é“å¤©é›·ï¼Œæœ‰äººåœ¨é‚£é‡Œå¾—åˆ°äº†ã€Šä¹éœ„å¼•é›·è¯€ã€‹çœŸä¼ ...');
            
            showEnding('é”™å¤±æœºç¼˜', 'æœ‰æ—¶å€™ï¼Œæœºä¼šå°±åœ¨çœ¼å‰ï¼Œå´å› ä¸ºçŠ¹è±«è€Œé”™è¿‡ã€‚', 'bad');
        }

        async function sceneCheckPole() {
            render(`<div class="story-text" id="poleText"></div>`);
            const textElement = document.getElementById('poleText');
            
            await typeWriter(textElement, 'æ²ˆè¨€çªç„¶æŒ‰ä½æ‰æ‹…â€”â€”\n\n');
            await typeWriter(textElement, '"å’”ï¼"\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(textElement, 'è£‚ç¼åº”å£°ç‚¸å¼€ï¼Œéœ²å‡ºé‡Œå¤´ç„¦é»‘çš„æœ¨èŠ¯â€”â€”ä¸‰ç™¾å¹´é›·å‡»æœ¨ï¼Œè¿˜æ˜¯è¢«åˆ»æ„è—èµ·æ¥çš„ï¼');
            
            addClue('é›·å‡»æœ¨æ‰æ‹…');
            
            textElement.innerHTML += '<br><br><button class="continue-btn" onclick="sceneOrderDouhua()">ç»§ç»­</button>';
        }

        async function sceneListen() {
            render(`<div class="story-text" id="listenText"></div>`);
            const textElement = document.getElementById('listenText');
            
            await typeWriter(textElement, 'ä½ é—­ä¸Šçœ¼ç›ï¼Œä»”ç»†è†å¬é‚£å†å–å£°...\n\n');
            await new Promise(r => setTimeout(r, 1000));
            await typeWriter(textElement, '"å’¸â€”â€”çš„â€”â€”ç”œâ€”â€”çš„â€”â€”çƒ«â€”â€”å˜´â€”â€”çš„â€”â€”"\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(textElement, 'è¿™éŸµå¾‹...ç¡®å®æš—åˆã€Šä¹éœ„å¼•é›·è¯€ã€‹çš„æ³•é—¨ï¼ä½†ä¼¼ä¹ç»è¿‡äº†åˆ»æ„çš„æ”¹å˜ï¼Œå˜æˆäº†å¸‚äº•å«å–ã€‚');
            
            addClue('å¼•é›·è¯€éŸµå¾‹');
            
            textElement.innerHTML += '<br><br><button class="continue-btn" onclick="sceneOrderDouhua()">ç»§ç»­</button>';
        }

        async function sceneOrderDouhua() {
            render(`<div class="story-text" id="douhuaText"></div>`);
            const textElement = document.getElementById('douhuaText');
            
            await typeWriter(textElement, 'è±†èŠ±ç¢—é€’åˆ°é¢å‰ï¼Œç¢—åº•æ²‰ç€å‡ ç²’æ¡‚èŠ±ï¼Œæ­£å·§æ’æˆä¸€é“é›·çº¹ã€‚\n\n');
            await new Promise(r => setTimeout(r, 800));
            await typeWriter(textElement, 'è€ç‹å¤´å˜Ÿå›”ï¼š"ç°åœ¨çš„å¹´è½»äººï¼Œå–ç¢—è±†èŠ±éƒ½è¿™ä¹ˆå¤§åŠ¨é™..."\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(textElement, 'æ²ˆè¨€ç›¯ç€ç¢—ï¼Œçªç„¶ç¬‘å‡ºå£°ã€‚\n\n');
            await typeWriter(textElement, '"æ‰¾åˆ°äº†ã€‚"');
            
            addClue('é›·çº¹æ¡‚èŠ±');
            saveGame();
            
            textElement.innerHTML += `${showClues()}
                <hr class="divider">
                <h3>æ¥ä¸‹æ¥æ€ä¹ˆåšï¼Ÿ</h3>
                <button class="choice-btn" onclick="scenePourDouhua()">æŠŠè±†èŠ±æ³¼åœ¨åœ°ä¸Šï¼Œè§‚å¯Ÿå˜åŒ–</button>
                <button class="choice-btn" onclick="sceneDrinkDouhua()">å–ä¸‹è±†èŠ±ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆååº”</button>
                <button class="choice-btn" onclick="sceneAskMore()">è¯¢é—®è€ç‹å¤´æ›´å¤šä¿¡æ¯</button>
            `;
        }

        async function scenePourDouhua() {
            render(`<div class="story-text" id="pourText"></div>`);
            const textElement = document.getElementById('pourText');
            
            await typeWriter(textElement, 'é›¨æ°´é¡ºç€ä¸‹å·´æ»´è¿›ç¢—é‡Œï¼Œé›·çº¹å¾®å¾®å‘äº®ã€‚\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(textElement, 'æ²ˆè¨€çªç„¶æŠŠç¢—ä¸€å€¾ï¼Œè±†èŠ±æ³¼åœ¨æ³¥åœ°ä¸Šã€‚\n\n');
            await typeWriter(textElement, '"è€ä¼¯ï¼Œå†æ¥ä¸€ç¢—ã€‚"ä»–æŠ¹äº†æŠŠè„¸ï¼Œ"è¿™æ¬¡è¦ç”œçš„ã€‚"\n\n');
            await new Promise(r => setTimeout(r, 800));
            await typeWriter(textElement, 'è€ç‹å¤´æ‘‡æ‘‡å¤´ï¼Œåˆèˆ€äº†ç¢—é€’ç»™ä»–ï¼š"å¹´è½»äººå°±æ˜¯ç³Ÿè¹‹ç²®é£Ÿ..."\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(textElement, 'æ²ˆè¨€æ²¡æ¥è¯ï¼Œåªæ˜¯ç›¯ç€ç¢—åº•â€”â€”é‚£å‡ ç²’æ¡‚èŠ±å·²ç»æ¢äº†ä½ç½®ï¼Œç°åœ¨æ’æˆäº†å¦ä¸€ä¸ªå›¾å½¢ï¼šä¸€é“é—ªç”µï¼ŒæŒ‡å‘åŸè¥¿ã€‚');
            
            addClue('åŸè¥¿çº¿ç´¢');
            
            textElement.innerHTML += '<br><br><button class="continue-btn" onclick="sceneFinalDecision()">ç»§ç»­</button>';
        }

        async function sceneDrinkDouhua() {
            render(`<div class="story-text" id="drinkText"></div>`);
            const textElement = document.getElementById('drinkText');
            
            await typeWriter(textElement, 'ä½ ä¸€å£å–ä¸‹è±†èŠ±...\n\n');
            await new Promise(r => setTimeout(r, 1000));
            await typeWriter(textElement, 'ä¸€è‚¡æš–æµä»ä¸¹ç”°å‡èµ·ï¼\n\n');
            await typeWriter(textElement, 'ä½“å†…çµåŠ›ç«Ÿç„¶éšéšæœ‰çªç ´çš„è¿¹è±¡ï¼\n\n');
            await new Promise(r => setTimeout(r, 800));
            await typeWriter(textElement, 'ä½†çº¿ç´¢...ä¼¼ä¹å°±è¿™æ ·é”™è¿‡äº†ã€‚');
            
            showEnding('é”™å¤±è‰¯æœº', 'è™½ç„¶å¾—åˆ°äº†ä¸€äº›å¥½å¤„ï¼Œä½†æœ€é‡è¦çš„çº¿ç´¢å´é”™è¿‡äº†ã€‚', 'neutral');
        }

        async function sceneAskMore() {
            render(`<div class="story-text" id="askText"></div>`);
            const textElement = document.getElementById('askText');
            
            await typeWriter(textElement, '"è€ä¼¯ï¼Œé‚£ä½ä»™äººè¿˜è¯´è¿‡ä»€ä¹ˆå—ï¼Ÿ"\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(textElement, 'è€ç‹å¤´æƒ³äº†æƒ³ï¼š"å¥½åƒè¯´...ç”œçš„å¾€è¥¿ï¼Œå’¸çš„å¾€ä¸œã€‚"\n\n');
            await typeWriter(textElement, '"ä¸è¿‡éƒ½æ˜¯èƒ¡è¯ï¼Œæˆ‘ä¹Ÿæ²¡å½“çœŸã€‚"');
            
            addClue('æ–¹ä½æç¤º');
            
            textElement.innerHTML += '<br><br><button class="continue-btn" onclick="scenePourDouhua()">ç»§ç»­</button>';
        }

        async function sceneFinalDecision() {
            render(`<div class="story-text" id="finalText"></div>`);
            const textElement = document.getElementById('finalText');
            
            await typeWriter(textElement, 'æ²ˆè¨€å’§å˜´ä¸€ç¬‘ï¼Œè™ç‰™ä¸Šè¿˜æ²¾ç€èŠéº»ã€‚\n\n');
            await new Promise(r => setTimeout(r, 500));
            await typeWriter(textElement, '"é”™ä¸äº†ã€‚"ä»–æŠŠç¢—æ£è¿›æ€€é‡Œï¼Œ"æ­£ç‰ˆæ—©å¤±ä¼ äº†ï¼Œè¿™æ­ªè°ƒå­åå€’æ´»å¾—ä¹…..."\n\n');
            await new Promise(r => setTimeout(r, 800));
            await typeWriter(textElement, 'é›¨åœäº†ã€‚\n\n');
            await typeWriter(textElement, 'å¤©è¾¹éšçº¦ä¼ æ¥é—·é›·ï¼Œåƒæ˜¯æŸä¸ªæ²‰ç¡å·²ä¹…çš„åŠŸæ³•ï¼Œç»ˆäºç­‰åˆ°äº†èƒ½å¬æ‡‚å®ƒçš„äººã€‚');
            
            thunderEffect();
            
            textElement.innerHTML += `${showClues()}
                <hr class="divider">
                <h3>ä½ å†³å®šï¼š</h3>
                <button class="choice-btn" onclick="endingGoWest()">ç«‹åˆ»å‰å¾€åŸè¥¿å¯»æ‰¾æœºç¼˜</button>
                <button class="choice-btn" onclick="endingResearch()">å…ˆå›å»ç ”ç©¶è¿™äº›çº¿ç´¢</button>
                <button class="choice-btn" onclick="endingFollow()">ç»§ç»­è·Ÿç€è±†èŠ±è½¦ï¼Œä¹Ÿè®¸è¿˜æœ‰å‘ç°</button>
            `;
        }

        async function endingGoWest() {
            render(`<div class="story-text" id="westText"></div>`);
            const textElement = document.getElementById('westText');
            
            await typeWriter(textElement, 'ä½ ä¸€è·¯ç–¾è¡Œï¼Œèµ¶å¾€åŸè¥¿...\n\n');
            await new Promise(r => setTimeout(r, 1000));
            thunderEffect();
            await typeWriter(textElement, 'åŸè¥¿ç ´åº™å‰ï¼Œé›·å…‰å¤§ä½œï¼\n\n');
            await typeWriter(textElement, 'ä¸€é“æ®‹ç ´çš„åŠŸæ³•çŸ³ç¢‘æµ®ç°åœ¨ç©ºä¸­ï¼\n\n');
            await new Promise(r => setTimeout(r, 800));
            await typeWriter(textElement, 'ã€Šä¹éœ„å¼•é›·è¯€ã€‹çš„æ°”æ¯æ‰‘é¢è€Œæ¥ï¼\n\n');
            await typeWriter(textElement, 'ä½ ç»ˆäºæ‰¾åˆ°äº†è¿™å¤±ä¼ å·²ä¹…çš„åŠŸæ³•ï¼');
            
            showEnding('å¯»å¾—çœŸä¼ ', 'ä½ é€šè¿‡æ•é”çš„è§‚å¯Ÿå’Œæœæ–­çš„è¡ŒåŠ¨ï¼ŒæˆåŠŸæ‰¾åˆ°äº†ã€Šä¹éœ„å¼•é›·è¯€ã€‹çš„ä¼ æ‰¿ï¼', 'perfect');
        }

        async function endingResearch() {
            render(`<div class="story-text" id="researchText"></div>`);
            const textElement = document.getElementById('researchText');
            
            await typeWriter(textElement, 'ä½ å›åˆ°ä½å¤„ï¼Œä»”ç»†ç ”ç©¶æ”¶é›†çš„çº¿ç´¢...\n\n');
            await new Promise(r => setTimeout(r, 1000));
            
            if (gameState.clues.length >= 4) {
                await typeWriter(textElement, 'é€šè¿‡æ·±å…¥ç ”ç©¶ï¼Œä½ ç«Ÿç„¶ä»è¿™äº›é›¶æ•£çš„çº¿ç´¢ä¸­ï¼Œæ¨æ¼”å‡ºäº†ã€Šä¹éœ„å¼•é›·è¯€ã€‹çš„éƒ¨åˆ†å¿ƒæ³•ï¼\n\n');
                await new Promise(r => setTimeout(r, 800));
                await typeWriter(textElement, 'è™½ç„¶ä¸æ˜¯å®Œæ•´ä¼ æ‰¿ï¼Œä½†å·²ç»è¶³å¤Ÿä½ ä¿®ç‚¼äº†ï¼');
                showEnding('è‡ªæ‚ŸçœŸè°›', 'æ™ºæ…§å¾€å¾€æ¯”è¿æ°”æ›´é‡è¦ã€‚ä½ é€šè¿‡è‡ªå·±çš„åŠªåŠ›ï¼Œé¢†æ‚Ÿäº†åŠŸæ³•çš„çœŸè°›ã€‚', 'good');
            } else {
                await typeWriter(textElement, 'çº¿ç´¢å¤ªå°‘ï¼Œä½ æ— æ³•æ¨æ¼”å‡ºå®Œæ•´çš„åŠŸæ³•...\n\n');
                await typeWriter(textElement, 'ä¸è¿‡ä½ ä¹Ÿè·å¾—äº†ä¸€äº›å¯å‘ã€‚');
                showEnding('ç•¥æœ‰æ‰€å¾—', 'è™½ç„¶æ²¡æœ‰å¾—åˆ°å®Œæ•´ä¼ æ‰¿ï¼Œä½†è¿™æ¬¡ç»å†ä¹Ÿè®©ä½ æœ‰æ‰€æ”¶è·ã€‚', 'neutral');
            }
        }

        async function endingFollow() {
            render(`<div class="story-text" id="followText"></div>`);
            const textElement = document.getElementById('followText');
            
            await typeWriter(textElement, 'ä½ å†³å®šç»§ç»­è·Ÿéšè±†èŠ±è½¦...\n\n');
            await new Promise(r => setTimeout(r, 1000));
            await typeWriter(textElement, 'è€ç‹å¤´æ¨ç€è½¦ï¼Œåœ¨åŸä¸­è½¬äº†ä¸€å¤§åœˆï¼Œæœ€ååœåœ¨äº†åŸè¥¿çš„ç ´åº™å‰ã€‚\n\n');
            await new Promise(r => setTimeout(r, 800));
            await typeWriter(textElement, '"åˆ°äº†ã€‚"è€ç‹å¤´çªç„¶å¼€å£ï¼Œ"èƒ½è·Ÿåˆ°è¿™é‡Œçš„ï¼Œå°±æ˜¯æœ‰ç¼˜äººã€‚"\n\n');
            await new Promise(r => setTimeout(r, 800));
            await typeWriter(textElement, 'ä»–æ‘˜ä¸‹æ–—ç¬ ï¼Œéœ²å‡ºå¹´è½»çš„é¢å®¹â€”â€”\n\n');
            await typeWriter(textElement, 'å“ªé‡Œæ˜¯ä»€ä¹ˆè€ç‹å¤´ï¼åˆ†æ˜æ˜¯ä¸ªä¿®ä¸ºæ·±åšçš„å‰è¾ˆï¼');
            
            showEnding('ç›´é¢çœŸä»™', 'ä½ å‘ç°äº†æœ€å¤§çš„ç§˜å¯†â€”â€”å–è±†èŠ±çš„è€ç‹å¤´ï¼Œå°±æ˜¯å½“å¹´ç•™ä¸‹åŠŸæ³•çš„ä»™äººï¼', 'hidden');
        }

        function showEnding(title, description, type) {
            const colors = {
                perfect: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                good: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                neutral: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
                bad: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                hidden: 'linear-gradient(135deg, #ffa751 0%, #ffe259 100%)'
            };
            
            const icons = {
                perfect: 'âš¡',
                good: 'ğŸ“–',
                neutral: 'ğŸŒŸ',
                bad: 'ğŸ˜”',
                hidden: 'ğŸ­'
            };
            
            setTimeout(() => {
                render(`
                    <div class="ending-box" style="background: ${colors[type] || colors.neutral};">
                        <h2>${icons[type]} ${title}</h2>
                        <p style="font-size: 1.1em; margin: 20px 0;">${description}</p>
                        ${showClues()}
                    </div>
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="choice-btn" onclick="showMainMenu()">è¿”å›ä¸»èœå•</button>
                        <button class="choice-btn" onclick="startNewGame()">å†ç©ä¸€æ¬¡</button>
                    </div>
                `);
            }, 2000);
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        window.onload = function() {
            showMainMenu();
            scrollToBottom();
        };
        // ===== è¿”å›ä¸»èœå•æ§åˆ¶ =====
        const __typingTimers = new Set();
        function __trackTimer(t){ __typingTimers.add(t); return t; }
        function __clearTypingTimers(){ __typingTimers.forEach(t=>clearInterval(t)); __typingTimers.clear(); }

        function setupHomeButton(){
            const header = document.querySelector('.header');
            if(!header) return;

            let btn = header.querySelector('.home-btn');
            if(!btn){
                btn = document.createElement('button');
                btn.className = 'home-btn';
                btn.title = 'è¿”å›ä¸»èœå• (Esc)';
                btn.textContent = 'ğŸ¯å½’å®—';
                btn.addEventListener('click', tryReturnToMenu);
                header.appendChild(btn);
            }

            // ä¸»èœå•ä¸æ˜¾ç¤ºæŒ‰é’®ï¼ˆæ£€æµ‹æ˜¯å¦æœ‰â€œå¼€å§‹æ¸¸æˆâ€å­—æ ·ï¼‰
            const isMainMenu = typeof gameState !== 'undefined' && gameState.currentScene === 'menu';
            btn.style.display = isMainMenu ? 'none' : 'flex';   // ç”¨ flexï¼Œå’Œä½ çš„å±…ä¸­æ ·å¼ä¸€è‡´

        }

        function tryReturnToMenu(){
            const ok = confirm('è¿”å›ä¸»èœå•ï¼Ÿå½“å‰è¿›åº¦å·²è‡ªåŠ¨ä¿å­˜ã€‚');
            if(ok){ __clearTypingTimers(); showMainMenu(); setupHomeButton(); }
        }

        document.addEventListener('keydown', e=>{
            if(e.key === 'Escape') tryReturnToMenu();
        });
        window.addEventListener('load', setupHomeButton);

    </script>
    <!-- ğŸŒ Translation hint button -->
    <button id="translateHint" title="Language / è¯­è¨€æç¤º">ğŸŒ</button>

    <script>
    const hintBtn = document.getElementById('translateHint');
    hintBtn.addEventListener('click', () => {
      alert('ğŸ’¡ If your browser language is not Chinese,\nclick the â€œTranslateâ€ button in your address bar.\n\nğŸŒ å¦‚æœæ‚¨ä½¿ç”¨éä¸­æ–‡æµè§ˆå™¨ï¼Œè¯·ç‚¹å‡»åœ°å€æ çš„ â€œTranslateâ€ æŒ‰é’®æŸ¥çœ‹ç¿»è¯‘ç‰ˆæœ¬ã€‚');
    });
    </script>
</body>
</html>
